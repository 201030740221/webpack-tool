// Generated by CoffeeScript 1.9.3
(function() {
  var fs;

  fs = require('node-file');

  module.exports = function(output) {
    return function() {
      return this.plugin('done', function(stats) {
        var data;
        data = {
          name: "frontend",
          version: "1.0.0",
          dependencies: {},
          commonDependencies: {}
        };
        stats.compilation.chunks.map(function(chunk) {
          return chunk.files.forEach(function(el) {
            var moduleName;
            if (chunk.name) {
              moduleName = chunk.name.replace('-', '/');
              if (moduleName === 'common') {
                if (el.match(/\.([0-9a-z]+)$/)[0] === ".js" || el.match(/\.([0-9a-z]+)$/)[0] === ".css") {
                  data.commonDependencies[chunk.name + el.match(/\.([0-9a-z]+)$/)[0]] = el;
                  return data.commonDependencies[chunk.name + el.match(/\.([0-9a-z]+)$/)[0] + '.map'] = el + '.map';
                }
              } else {
                if (el.match(/\.([0-9a-z]+)$/)[0] === ".js" || el.match(/\.([0-9a-z]+)$/)[0] === ".css") {
                  data.dependencies[moduleName] = data.dependencies[moduleName] || {};
                  data.dependencies[moduleName][chunk.name + el.match(/\.([0-9a-z]+)$/)[0]] = el;
                  return data.dependencies[moduleName][chunk.name + el.match(/\.([0-9a-z]+)$/)[0] + '.map'] = el + '.map';
                }
              }
            }
          });
        });
        return fs.writeFileSync(output, JSON.stringify(data));
      });
    };
  };

}).call(this);
